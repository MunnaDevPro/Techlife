 {% load static %}
<style>
    [x-cloak] {
        display: none !important;
    }
    
    .flip-horizontal {
        transform: scaleX(-1);
        /* Icon horizontally flip korbe */
    }
</style>

<div class="max-w-7xl mx-auto px-1 font-inter -mt-8">
    <!-- Flex container for main content -->
    <div class="flex flex-col lg:flex-row gap-4 mx-auto mt-6">
        <!-- LEFT all question  (Post) -->

        <div class="w-full lg:w-2/3 max-w-2xl flex-shrink-0 mx-auto " id="question-container">
            <div class="flex flex-wrap items-center gap-2 md:gap-4 mb-3 relative md:ml-5 w-full mt-4 mx-auto">
                {% comment %} Sort Dropdown menu {% endcomment %}
                <div x-data="{ open: false }" class="relative" @click.away="open = false">
                    <div class="relative">
                        <div class="flex items-center gap-1">
                            <button @click="open = !open" :class="{'bg-gray-200': open}" class="font-semibold font-inter text-sm text-gray-600 py-2 px-3 flex items-center gap-1 rounded-2xl hover:bg-gray-200 transition-colors">
                    Latest
                    <svg fill="currentColor" height="16" viewBox="0 0 20 20" width="16" xmlns="http://www.w3.org/2000/svg">
                        <path d="M10 13.7a.897.897 0 01-.636-.264l-4.6-4.6a.9.9 0 111.272-1.273L10 11.526l3.964-3.963a.9.9 0 011.272 1.273l-4.6 4.6A.897.897 0 0110 13.7z"></path>
                    </svg>
                </button>
                        </div>

                        <div x-show="open" x-transition class="absolute left-0 mt-2 w-36 bg-white border rounded-2xl shadow-lg z-20" x-cloak>
                            <a hx-get="?sort=latest{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}" hx-target="#blog_post_form" hx-push-url="true" @click="open = false" class="px-4 py-2 hover:bg-gray-100 cursor-pointer flex items-center gap-2 {% if request.GET.sort == 'latest' or not request.GET.sort %}bg-gray-100 rounded-t-2xl{% endif %}">
                                <span>Latest</span>
                            </a>
                            <a hx-get="?sort=new{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}" hx-target="#blog_post_form" hx-push-url="true" @click="open = false" class="px-4 py-2 hover:bg-gray-100 cursor-pointer flex items-center gap-2 {% if request.GET.sort == 'new' %}bg-gray-100{% endif %}">
                                <span>New</span>
                            </a>
                            <a hx-get="?sort=top{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}" hx-target="#blog_post_form" hx-push-url="true" @click="open = false" class="px-4 py-2 hover:bg-gray-100 cursor-pointer flex items-center gap-2 {% if request.GET.sort == 'top' %}bg-gray-100{% endif %}">
                                <span>Top</span>
                            </a>
                            <a hx-get="?sort=best{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}" hx-target="#blog_post_form" hx-push-url="true" @click="open = false" class="px-4 py-2 hover:bg-gray-100 cursor-pointer flex items-center gap-2 {% if request.GET.sort == 'best' %}bg-gray-100 rounded-b-2xl{% endif %}">
                                <span>Best</span>
                            </a>
                        </div>
                    </div>
                </div>

                {% comment %} Everywhere Dropdown {% endcomment %}
                <div x-data="{ open: false }" class="relative" @click.away="open = false" x-cloak>
                    <div class="relative">
                        <div class="flex items-center gap-1">
                            <button @click="open = !open" :class="{'bg-gray-200': open}" class="font-semibold font-inter text-sm text-gray-600 py-2 px-3 flex items-center gap-1 rounded-2xl hover:bg-gray-200 transition-colors">
                    Everywhere
                    <svg fill="currentColor" height="16" viewBox="0 0 20 20" width="16" xmlns="http://www.w3.org/2000/svg">
                        <path d="M10 13.7a.897.897 0 01-.636-.264l-4.6-4.6a.9.9 0 111.272-1.273L10 11.526l3.964-3.963a.9.9 0 011.272 1.273l-4.6 4.6A.897.897 0 0110 13.7z"></path>
                    </svg>
                </button>
                        </div>

                        <div x-show="open" x-transition class="absolute left-0 mt-2 w-48 bg-white border rounded-2xl shadow-lg z-20" x-cloak>
                            <div class="px-4 py-2 bg-gray-50 font-bold rounded-t-2xl">Countries</div>
                            <div class="px-4 py-2 hover:bg-gray-100 cursor-pointer">Australia</div>
                            <div class="px-4 py-2 hover:bg-gray-100 cursor-pointer">Bangladesh</div>
                            <div class="px-4 py-2 hover:bg-gray-100 cursor-pointer">India</div>
                        </div>
                    </div>
                </div>

                <div class="flex-1 min-w-[240px] md:min-w-0">
                    <form hx-get="." hx-target="#blog_post_form" hx-swap="innerHTML" hx-push-url="true" hx-trigger="submit, keyup changed delay:500ms from:input[name='q']" class="relative w-full max-w-sm">
                        {% if request.GET.sort %}
                        <input type="hidden" name="sort" value="{{ request.GET.sort }}"> {% endif %}

                        <span class="absolute inset-y-0 left-3 flex items-center pointer-events-none">
                <svg fill="currentColor" height="16" viewBox="0 0 20 20" width="16" class="text-gray-500">
                    <path d="M18.736 17.464l-3.483-3.483A7.961 7.961 0 0016.999 9 8 8 0 109 17a7.961 7.961 0 004.981-1.746l3.483 3.483a.9.9 0 101.272-1.273zM9 15.2A6.207 6.207 0 012.8 9c0-3.419 2.781-6.2 6.2-6.2s6.2 2.781 6.2 6.2-2.781 6.2-6.2 6.2z"></path>
                </svg>
            </span>
                        <input type="search" name="q" value="{{ request.GET.q }}" placeholder="Search question" class="w-full md:w-[90%] pl-10 pr-4 py-1.5 rounded-full border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-200 shadow-sm" />
                    </form>
                </div>
            </div>

            <div class="space-y-4 mx-auto">
                {% for question in questions %}
                <!-- Card 1 -->
                <div class="bg-white p-4 md:pl-5 md:pt-5 md:pb-4 md:pr-4 mt-5 border rounded-xl hover:shadow-sm flex flex-col md:flex-row items-start justify-between gap-4">
                    <div class="flex flex-row items-start gap-3 flex-1 w-full">
                        <img src="{{ question.author.profile_picture.url }}" class="w-10 h-10 md:w-12 md:h-12 rounded-full object-cover shrink-0" alt="avatar" />

                        <div class="flex-1 min-w-0">
                            <a hx-get="{% url 'questions' slug=question.slug %}" hx-target="#blog_post_form" hx-swap="innerHTML" hx-push-url="true" class="text-base md:text-lg font-semibold text-gray-800 line-clamp-2 hover:text-blue-500 cursor-pointer transition-colors block">
                {{ question.title }}
            </a>

                            <div class="text-xs md:text-sm text-gray-500 flex items-center flex-wrap gap-1 mt-1">
                                <svg aria-hidden="true" class="shrink-0" fill="currentColor" height="14" viewBox="0 0 20 20" width="14">
                    <path d="M12.8 17.524l6.89-6.887a.9.9 0 000-1.273L12.8 2.477a1.64 1.64 0 00-1.782-.349 1.64 1.64 0 00-1.014 1.518v2.593C4.054 6.728 1.192 12.075 1 17.376a1.353 1.353 0 00.862 1.32 1.35 1.35 0 001.531-.364l.334-.381c1.705-1.944 3.323-3.791 6.277-4.103v2.509c0 .667.398 1.262 1.014 1.518a1.638 1.638 0 001.783-.349v-.002zm-.994-1.548V12h-.9c-3.969 0-6.162 2.1-8.001 4.161.514-4.011 2.823-8.16 8-8.16h.9V4.024L17.784 10l-5.977 5.976z"></path>
                </svg>
                                <span>Latest reply from</span> {% with last_answer=question.answers.first %} {% if last_answer %}
                                <span class="font-medium text-gray-700">@{{ last_answer.author.last_name }}</span>
                                <span class="text-green-500 font-bold mx-0.5">Â·</span>
                                <span>{{ question.created_at|timesince|slice:":20" }} ago</span> {% else %}
                                <span class="font-medium italic">No replies yet</span> {% endif %} {% endwith %}
                            </div>

                            <p class="text-gray-600 mt-2 text-sm line-clamp-2 md:line-clamp-3">
                                {{ question.content }}
                            </p>
                        </div>
                    </div>

                    <div class="flex flex-row md:flex-col items-center md:items-end justify-between md:justify-start w-full md:w-auto border-t md:border-t-0 pt-3 md:pt-0 mt-2 md:mt-0">
                        <div class="flex -space-x-2 md:-space-x-3 mb-1 flex-wrap">
                            {% for answer in question.answers.all|slice:"4" %}
                            <img src="{{ answer.author.profile_picture.url }}" class="w-7 h-7 md:w-8 md:h-8 rounded-full border-2 border-white shadow-sm" /> {% endfor %} {% if question.answers.count > 4 %}
                            <div class="w-7 h-7 md:w-8 md:h-8 flex items-center justify-center bg-gray-100 text-gray-600 rounded-full border-2 border-white text-[10px] md:text-xs font-bold">
                                +{{ question.answers.count|add:"-4" }}
                            </div>
                            {% endif %}
                        </div>

                        <div class="flex items-center text-gray-500 text-xs md:text-sm font-semibold md:mt-2">
                            <svg aria-hidden="true" class="shrink-0" fill="currentColor" height="16" viewBox="0 0 20 20" width="16">
                <path d="M10 1a9 9 0 00-9 9c0 1.947.79 3.58 1.935 4.957L.231 17.661A.784.784 0 00.785 19H10a9 9 0 009-9 9 9 0 00-9-9zm0 16.2H6.162c-.994.004-1.907.053-3.045.144l-.076-.188a36.981 36.981 0 002.328-2.087l-1.05-1.263C3.297 12.576 2.8 11.331 2.8 10c0-3.97 3.23-7.2 7.2-7.2s7.2 3.23 7.2 7.2-3.23 7.2-7.2 7.2z"></path>
            </svg>
                            <span class="ml-1.5">{{ question.answers.count }} <span class="hidden sm:inline">Comments</span><span class="sm:hidden">Reply</span></span>
                        </div>
                    </div>
                </div>

                {% empty %}
                <div class="flex flex-col items-center justify-center py-12 px-4 text-center">
                    <div class="bg-gray-100 rounded-full p-6 mb-4">
                        <svg class="w-12 h-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-900">No answers found</h3>
                    <p class="text-gray-500 mt-1">
                        We couldn't find any results for <span class="font-medium text-blue-600">"{{ query }}"</span>.
                    </p>
                    <button hx-get="." hx-target="#blog_post_form" class="mt-4 text-sm text-blue-500 hover:underline cursor-pointer">
            Clear search and see all
        </button>
                </div>
                {% endfor %}

            </div>




            {% if questions %}
            <div class="mt-16 mb-10 flex justify-center">
                <nav class="flex items-center gap-1 p-1 bg-white/80 backdrop-blur-md border border-gray-200/60 rounded-2xl shadow-sm ring-1 ring-black/5" aria-label="Pagination">

                    {% if questions.has_previous %}
                    <a hx-get="?page={{ questions.previous_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.sort %}&sort={{ request.GET.sort }}{% endif %}" hx-target="#blog_post_form" hx-push-url="true" hx-swap="innerHTML" class="flex items-center justify-center w-10 h-10 rounded-xl text-gray-500 hover:bg-gray-100 hover:text-gray-900 transition-all duration-200 cursor-pointer"
                        title="Previous">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.75" d="M15 19l-7-7 7-7"/></svg>
                    </a>
                    {% else %}
                    <span class="flex items-center justify-center w-10 h-10 rounded-xl text-gray-200 cursor-not-allowed">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.75" d="M15 19l-7-7 7-7"/></svg>
        </span> {% endif %}

                    <div class="flex items-center px-4 h-10 bg-gray-50/50 rounded-xl border border-gray-100 mx-1">
                        <span class="text-xs font-bold uppercase tracking-widest text-gray-400 mr-2">Page</span>
                        <span class="text-sm font-semibold text-blue-600">{{ questions.number }}</span>
                        <span class="text-sm font-medium text-gray-300 mx-2">of</span>
                        <span class="text-sm font-semibold text-gray-600">{{ questions.paginator.num_pages }}</span>
                    </div>

                    {% if questions.has_next %}
                    <a hx-get="?page={{ questions.next_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.sort %}&sort={{ request.GET.sort }}{% endif %}" hx-target="#blog_post_form" hx-push-url="true" hx-swap="innerHTML" class="flex items-center justify-center w-10 h-10 rounded-xl text-gray-500 hover:bg-gray-100 hover:text-gray-900 transition-all duration-200 cursor-pointer"
                        title="Next">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.75" d="M9 5l7 7-7 7"/></svg>
                    </a>
                    {% else %}
                    <span class="flex items-center justify-center w-10 h-10 rounded-xl text-gray-200 cursor-not-allowed">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.75" d="M9 5l7 7-7 7"/></svg>
        </span> {% endif %}

                </nav>
            </div>
            {% endif %}
        </div>

        <!-- MIDDLE GAP -->
        <div class="w-1 bg-gray-100 flex-shrink-0 mx-auto"></div>

        <!-- RIGHT SIDEBAR -->
        {% include 'forum/right_sidebar.html' %}
    </div>

</div>