{% load static %}

<style>
    .answer-content,
    .answer-content * {
        color: #696e79 !important;
        font-size: 0.875rem !important;
        background-color: transparent !important;
    }
</style>
<style>
    [x-cloak] {
        display: none !important;
    }
</style>
<div class="flex items-center gap-2 px-4 md:pl-4 md:ml-5 mx-auto">
    <h3 class="text-xl md:text-2xl text-gray-900 font-inter font-semibold">
        {{ particular_question.answers.count }} Answer{{ particular_question.answers.count|pluralize }}
    </h3>
    <svg aria-hidden="true" class="text-gray-600" width="18" height="18" viewBox="0 0 18 18">
        <path d="m16.01 7.43-1.4-1.41L9 11.6 3.42 6l-1.4 1.42 7 7z" fill="currentColor"></path>
    </svg>
</div>

<div x-data="{ open: false }" class="flex flex-col md:flex-row items-center gap-4 mt-4 mb-5 relative px-4 md:ml-5 max-w-7xl mx-auto" x-cloak>

    <div class="relative w-full md:w-auto flex justify-start items-center" @click.away="open = false">
        <div class="flex items-center gap-1">
            <span class="font-inter text-sm text-gray-600 whitespace-nowrap">Sort by:</span>

            <button @click="open = !open" :class="{'bg-gray-200': open}" class="font-semibold font-inter text-sm text-gray-600 py-2 px-3 flex items-center gap-1 rounded-2xl hover:bg-gray-200 transition-colors border md:border-transparent">
                {{ current_sort|default:"Best" }}
                <svg fill="currentColor" height="16" viewBox="0 0 20 20" width="16">
                    <path d="M10 13.7a.897.897 0 01-.636-.264l-4.6-4.6a.9.9 0 111.272-1.273L10 11.526l3.964-3.963a.9.9 0 011.272 1.273l-4.6 4.6A.897.897 0 0110 13.7z"></path>
                </svg>
            </button>
        </div>

        <div x-show="open" x-transition class="absolute top-full left-14 md:left-12 mt-1 w-36 bg-white border rounded-xl shadow-xl z-20" x-cloak>
            <a hx-get="{% url 'questions' slug=particular_question.slug %}?sort=best" hx-target="#blog_post_form" hx-swap="innerHTML" @click="open = false" class="px-4 py-2 hover:bg-gray-100 cursor-pointer flex items-center gap-2 rounded-t-xl">
                <span>Best</span>
            </a>
            <a hx-get="{% url 'questions' slug=particular_question.slug %}?sort=old" hx-target="#blog_post_form" hx-swap="innerHTML" @click="open = false" class="px-4 py-2 hover:bg-gray-100 cursor-pointer flex items-center gap-2">
                <span>Old</span>
            </a>
            <a hx-get="{% url 'questions' slug=particular_question.slug %}?sort=top" hx-target="#blog_post_form" hx-swap="innerHTML" @click="open = false" class="px-4 py-2 hover:bg-gray-100 cursor-pointer flex items-center gap-2">
                <span>Top</span>
            </a>
            <a hx-get="{% url 'questions' slug=particular_question.slug %}?sort=recently" hx-target="#blog_post_form" hx-swap="innerHTML" hx-push-url="true" @click="open = false" class="px-4 py-2 hover:bg-gray-100 cursor-pointer flex items-center gap-2 rounded-b-xl">
                <span>Recently</span>
            </a>
        </div>
    </div>

    <div class="w-full flex-1 px-1">
        <form hx-get="{% url 'questions' slug=particular_question.slug %}" hx-target="#blog_post_form" hx-swap="innerHTML" class="w-full">
            <div class="relative w-full max-w-md group">
                <span class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                <svg fill="currentColor" height="18" viewBox="0 0 20 20" width="18" class="text-gray-400 group-focus-within:text-blue-500 transition-colors">
                    <path d="M18.736 17.464l-3.483-3.483A7.961 7.961 0 0016.999 9 8 8 0 109 17a7.961 7.961 0 004.981-1.746l3.483 3.483a.9.9 0 101.272-1.273zM9 15.2A6.207 6.207 0 012.8 9c0-3.419 2.781-6.2 6.2-6.2s6.2 2.781 6.2 6.2-2.781 6.2-6.2 6.2z"></path>
                </svg>
            </span>

                <input type="search" name="q" value="{{ query|default:'' }}" placeholder="Search answers..." class="w-full pl-11 pr-14 md:pr-24 py-2.5 rounded-full border border-gray-300 bg-gray-50 focus:bg-white focus:outline-none focus:ring-2 focus:ring-blue-100 focus:border-blue-400 shadow-sm transition-all"
                />

                <button type="submit" class="absolute right-1.5 top-1.5 bottom-1.5 flex items-center justify-center px-4 md:px-6 bg-gray-800 hover:bg-black text-white rounded-full transition-all active:scale-95 shadow-sm">
                <span class="md:hidden">
                    <svg fill="none" stroke="currentColor" stroke-width="2.5" height="18" viewBox="0 0 24 24" width="18" xmlns="http://www.w3.org/2000/svg">
                        <path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" stroke-linecap="round" stroke-linejoin="round"></path>
                    </svg>
                </span>
                <span class="hidden md:inline text-sm font-medium">Search</span>
            </button>
            </div>
        </form>
    </div>
</div>



{% comment %} answer section {% endcomment %}
<div class="relative pl-0 md:pl-3 ml-2 md:ml-5 pr-2 md:pr-0">
    {% if paginator_answer %}
    <div class="absolute top-0 bottom-0 left-3 md:left-5 w-0.5 bg-gray-300"></div>
    {% endif %} {% for answer in paginator_answer %}
    <div class="mb-6 md:mb-8 relative flex items-start space-x-3 md:space-x-4">
        <div class="relative z-10 w-6 h-6 rounded-full bg-gray-400 text-white flex-shrink-0 flex justify-center items-center text-[10px] md:text-xs">
            {{ paginator_answer.start_index|add:forloop.counter0 }}
        </div>

        <div class="bg-white w-full pt-0.5 pb-2 rounded-lg min-w-0">
            <div class="flex items-start gap-2 md:gap-3">
                <img src="{{ answer.author.profile_picture.url }}" class="w-7 h-7 rounded-full object-cover border flex-shrink-0" />

                <div class="flex flex-col leading-tight w-full min-w-0">
                    <div class="flex flex-col md:flex-row md:items-center justify-between w-full">
                        <span class="font-inter text-sm md:text-md font-semibold text-gray-600 hover:text-blue-500 cursor-pointer truncate">
                            {{ answer.author.first_name }} {{ answer.author.last_name }}
                        </span>

                        <div class="flex items-center gap-1 mt-0.5 md:mt-0">
                            <span class="text-green-600 hidden md:inline">â€¢</span>
                            <span class="font-inter text-[10px] md:text-[12px] text-gray-400 whitespace-nowrap">
                                {{ answer.created_at|timesince|slice:":10" }} ago
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="answer-content mt-2">
                <p class="text-[13px] md:text-sm text-gray-700 leading-relaxed break-words">
                    {{ answer.content|safe }}
                </p>
            </div>
        </div>
    </div>
    {% endfor %} {% if paginator_answer %}
    <div class="mt-10 md:mt-16 mb-10 flex justify-center pr-4 md:pr-0">
        <nav class="flex items-center gap-0.5 md:gap-1 p-1 bg-white/80 backdrop-blur-md border border-gray-200/60 rounded-2xl shadow-sm ring-1 ring-black/5 scale-90 md:scale-100" aria-label="Pagination">

            {% if paginator_answer.has_previous %}
            <a hx-get="?page={{ paginator_answer.previous_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.sort %}&sort={{ request.GET.sort }}{% endif %}" hx-target="#blog_post_form" hx-push-url="true" class="flex items-center justify-center w-8 h-8 md:w-10 md:h-10 rounded-xl text-gray-500 hover:bg-gray-100 transition-all cursor-pointer">
                <svg class="w-4 h-4 md:w-5 md:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.75" d="M15 19l-7-7 7-7"/></svg>
            </a>
            {% else %}
            <span class="flex items-center justify-center w-8 h-8 md:w-10 md:h-10 rounded-xl text-gray-200 cursor-not-allowed">
                <svg class="w-4 h-4 md:w-5 md:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.75" d="M15 19l-7-7 7-7"/></svg>
            </span> {% endif %}

            <div class="flex items-center px-2 md:px-4 h-8 md:h-10 bg-gray-50/50 rounded-xl border border-gray-100 mx-0.5 md:mx-1">
                <span class="text-[10px] font-bold uppercase tracking-widest text-gray-400 mr-1.5 md:mr-2">Page</span>
                <span class="text-xs md:text-sm font-semibold text-blue-600">{{ paginator_answer.number }}</span>
                <span class="text-xs md:text-sm font-medium text-gray-300 mx-1 md:mx-2">/</span>
                <span class="text-xs md:text-sm font-semibold text-gray-600">{{ paginator_answer.paginator.num_pages }}</span>
            </div>

            {% if paginator_answer.has_next %}
            <a hx-get="?page={{ paginator_answer.next_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.sort %}&sort={{ request.GET.sort }}{% endif %}" hx-target="#blog_post_form" hx-push-url="true" class="flex items-center justify-center w-8 h-8 md:w-10 md:h-10 rounded-xl text-gray-500 hover:bg-gray-100 transition-all cursor-pointer">
                <svg class="w-4 h-4 md:w-5 md:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.75" d="M9 5l7 7-7 7"/></svg>
            </a>
            {% else %}
            <span class="flex items-center justify-center w-8 h-8 md:w-10 md:h-10 rounded-xl text-gray-200 cursor-not-allowed">
                <svg class="w-4 h-4 md:w-5 md:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.75" d="M9 5l7 7-7 7"/></svg>
            </span> {% endif %}

        </nav>
    </div>
    {% endif %}
</div>



<!-- Auto Adjust Line Heights -->
<script>
    document.querySelectorAll('.step-item').forEach((step, index, steps) => {
        const line = step.querySelector('.step-line');
        if (index === 0) {
            line.style.top = '12px'; // First one starts from middle of circle
        }

        if (index === steps.length - 1) {
            line.style.height = '12px'; // Last one ends at circle center
        } else {
            line.style.height = step.offsetHeight + 12 + 'px';
        }
    });
</script>